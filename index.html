<!doctype html><html lang=en-us prefix="og: http://ogp.me/ns#"><head><meta name=generator content="Hugo 0.83.1"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Content Security Policy</title><meta charset=utf-8><link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,700,700i%7CMaitree:200,300,400,600,700&subset=latin-ext" rel=stylesheet><link rel=stylesheet type=text/css media=all href=css/webslides.css><link rel=stylesheet type=text/css media=all href=css/svg-icons.css><link rel="shortcut icon" sizes=16x16 href=/img/favicons/favicon.png><link rel="shortcut icon" sizes=32x32 href=/img/favicons/favicon-32.png><link rel="apple-touch-icon icon" sizes=76x76 href=/img/favicons/favicon-76.png><link rel="apple-touch-icon icon" sizes=120x120 href=/img/favicons/favicon-120.png><link rel="apple-touch-icon icon" sizes=152x152 href=/img/favicons/favicon-152.png><link rel="apple-touch-icon icon" sizes=180x180 href=/img/favicons/favicon-180.png><link rel="apple-touch-icon icon" sizes=192x192 href=/img/favicons/favicon-192.png><meta name=mobile-web-app-capable content="yes"><meta name=theme-color content="#333333"></head><body><main role=main><article id=webslides><section id=slide1><div class="wrap size-70"><div class=aligncenter><h2 id=what-is-csp><strong>What is CSP?</strong></h2><p>Content Security Policy (CSP) determines where resources (JavaScript, stylesheets, fonts etc)
can be loaded from.</p></div></div></section><section id=slide2><div class=wrap><h2 id=how-does-it-work>How does it work?</h2><p>CSP provides a number of <em>directives</em> which are included in the <code>Content-Security-Policy</code> HTTP
Header, or an equivalent <code>meta</code> tag. (If using a <code>meta</code> tag, it should be early in the <code>head</code>, as
only resources listed <em>after</em> the declaration will be included in the policy.)</p><p>Some common (and useful ones) are:</p><ul><li><code>default-src</code></li><li><code>script-src</code></li><li><code>font-src</code></li><li><code>style-src</code></li><li><code>img-src</code></li><li><code>connect-src</code></li></ul><p>The whole list is available
at <a href=https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy>https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy</a></p></div></section><section id=slide3><div class=wrap><div class=aligncenter><h2 id=directives><strong>Directives</strong></h2></div></div></section><section id=slide4><div class=wrap><h2 id=directives-1>Directives</h2><h3 id=default-src><code>default-src</code></h3><p>This provides the default settings for any directives which are not otherwise included in the
policy.</p><p>Note that it is a fallback for when a directive is not declared; if you specify a directive,
<code>default-src</code> is ignored for that type.</p></div></section><section id=slide5><div class=wrap><h2 id=directives-2>Directives</h2><h3 id=default-src-example><code>default-src</code> Example</h3><pre><code class="language-http request" data-lang="http request">Content-Security-Policy: default-src &#39;self&#39; https:; script-src &#39;self&#39;;</code></pre><p>Anything which is <em>not</em> a script will use the default source, e.g. stylesheets, fonts, etc. These
can all be loaded either from <code>'self'</code> (i.e. the request origin) <strong>or</strong> any connection as long as it
is over <code>https</code>.</p><p>Scripts, however, can only be served from the local server.</p></div></section><section id=slide6><div class=wrap><h2 id=directives-3>Directives</h2><h3 id=script-src><code>script-src</code></h3><p>Defines where <code>script</code>s may be loaded from. This is almost exclusively for JavaScript.</p><h3 id=style-src><code>style-src</code></h3><p>Defines where <code>style</code> elements (including stylesheets) may be loaded from.</p><h3 id=img-src><code>img-src</code></h3><p>Exactly what you&rsquo;d expect&mldr;</p><h3 id=font-src><code>font-src</code></h3><p>This one too&mldr;</p></div></section><section id=slide7><div class=wrap><h2 id=directives-4>Directives</h2><h3 id=connect-src><code>connect-src</code></h3><p>This restricts the URLs which can be loaded using script interfaces, for example, remote scripts
which are loaded by Google Tag Manager and other resources fetched via <code>XMLHttpRequest</code> to be loaded
into the page.</p></div></section><section id=slide8><div class=wrap><div class=aligncenter><h2 id=values><strong>Values</strong></h2></div></div></section><section id=slide9><div class=wrap><h2 id=values-1>Values</h2><h3 id=self><code>'self'</code></h3><p>The request origin (including URL and port). (Quotes are required.)</p></div></section><section id=slide10><div class=wrap><h2 id=values-2>Values</h2><h3 id=scheme-sources-ends-with>Scheme sources (ends with &lsquo;:&lsquo;)</h3><p>This allows for the protocol or data scheme, such as <code>https:</code> or <code>data:</code> or <code>blob:</code>. Generally data
schemes are not recommended as they ar insecure; however, there is some application for using
<code>data:</code> for fonts and images, and <code>blob:</code> is useful for Rails in development mode when using
webpacker. (Quotes are not required.)</p></div></section><section id=slide11><div class=wrap><h2 id=values-3>Values</h2><h3 id=url>URL</h3><p>Allows content to be loaded from a particular remote URL. This can optionally include the protocol,
and accepts wildcards.</p><p>Example:</p><pre><code class="language-http request" data-lang="http request">Content-Security-Policy: default-src &#39;self&#39; https://my.example.com; script-src &#39;self&#39; *.cdnjs.com;</code></pre></div></section><section id=slide12><div class=wrap><h2 id=values-4>Values</h2><h3 id=none><code>'none'</code></h3><p>Empty set. Allows no resources. Usually used for content elements like <code>object</code> where it is unlikely
to be used. (Quotes are required.)</p></div></section><section id=slide13><div class=wrap><h2 id=values-5>Values</h2><h3 id=unsafe-inline><code>'unsafe-inline'</code></h3><p>Allows the execution of inline content on the page, e.g. a <code>script</code> or <code>style</code> tag.</p><h3 id=unsafe-eval><code>'unsafe-eval'</code></h3><p>Allows execution of JavaScript <code>eval</code> or <code>Function</code> declarations to load content.</p><p>Both of these directives are considered unsafe and should be avoided if at all possible, or used in
conjunction with&mldr;</p></div></section><section id=slide14><div class=wrap><h2 id=values-6>Values</h2><h3 id=nonce-base64-value><code>nonce-&lt;base64 value></code></h3><p>Specifies a nonce that can be included in element declarations, indicating that this particular
entry has been allowed. This can be used in conjunction with <code>'unsafe-inline'</code> to explicitly declare
which inline entries are allowed.</p><pre><code class="language-http request" data-lang="http request">Content-Security-Policy: default-src &#39;self&#39; nonce-rAnd0m;</code></pre><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>nonce</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;rAnd0m&#34;</span>&gt;
  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;This script will execute...&#34;</span>);
&lt;/<span style=color:#f92672>script</span>&gt;

&lt;<span style=color:#f92672>script</span>&gt;
  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;...but this one will not.&#34;</span>);
&lt;/<span style=color:#f92672>script</span>&gt;</code></pre></div><p><strong>NOTE:</strong> This can only be used with elements that have a <code>nonce</code> attribute. For example, <code>img</code>
does not have a <code>nonce</code> attribute, so <code>nonce</code> cannot be used as a value for <code>img-src</code> directives.</p></div></section><section id=slide15><div class=wrap><h2 id=values-7>Values</h2><h3 id=hash-algorithm-base64-value><code>&lt;hash algorithm>-&lt;base64 value></code></h3><p>Specifies a hash matching the hash value of a given element (using the specified algorithm, and
excluding the element &ndash; e.g. <code>script</code> or <code>style</code> &ndash; tags). Whitespace is important. Generally not
advisable as this one can be quite brittle and requires recalculation if the element&rsquo;s value changes
at all.</p><p>In CSP 2.0, this is applied only to inline scripts. CSP 3.0 allows it in the case of <code>script-src</code>
for external scripts.</p></div></section><section id=slide16><div class=wrap><h2 id=values-8>Values</h2><h3 id=strict-dynamic-csp-3-0-only><code>'strict-dynamic'</code> (CSP 3.0 only)</h3><p>This specifies that the trust explicitly given to a script present in the markup, by accompanying it
with a nonce or a hash, shall be propagated to all the scripts loaded by that root script. At the
same time, any allow-list or source expressions such as <code>'self'</code> or <code>'unsafe-inline'</code>
are ignored.</p><p>Example: this would allow any scripts loaded via GTM (or Ensighten) to be trusted automatically, as
long as the original script was allowed (using a nonce).</p></div></section><section id=slide17><div class=wrap><h2 id=how-do-i-test-it-though>How do I test it, though?</h2><p>CSP has the ability to very quickly break a site if something is missed. To accommodate this, CSP
includes an alternate header, <code>Content-Security-Policy-Report-Only</code>. If this is included in place of
the standard CSP header (not alongside!), instead of blocking the resource, it will POST a JSON
object to a defined <code>report-uri</code> specified in the directive.</p><p>The JSON payload is quite comprehensive and provides details on which directive has been violated as
well as the source URI, which makes it easy to re-work your CSP to add the required values to the
necessary directive(s).</p></div></section><section id=slide18><div class=wrap><div class=aligncenter><h2 id=any-questions><strong>Any Questions?</strong></h2></div></div></section></article></main><script src=js/webslides.min.js></script><script>window.ws=new WebSlides({minWheelDelta:40,scrollWait:450,slideOffset:50})</script><script defer src=js/svg-icons.js></script></body></html>